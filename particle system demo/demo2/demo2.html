<html>
<canvas id="myCanvas"></canvas>

<style>
    body {
        background-color: black;
        margin: 0;
        padding: 0;
        font-family: sans-serif;

    }
</style>



<head>

    <script>
        window.onload = function () {
            // Get the canvas element
            var canvas = document.getElementById("myCanvas");
            var cvs = canvas.getContext("2d");

            // Set canvas dimensions
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            // console.log(canvas.width, canvas.height);
            // Create an array to store the particles
            var particles = [];

            // Define the properties of the thick line segment
            var x1 = 100;
            var y1 = 100;
            var x2 = 500;
            var y2 = 400;
            var radius = 25;

            var endPoint = { x: x1, y: y1 };
            var startPoint = { x: x2, y: y2 };

            // Define the dimensions of the 2D array
            var width = 1000;
            var height = 1000;

            // Create a 2D array and initialize all elements to 0
            var array2d = new Array(width);
            for (var i = 0; i < width; i++) {
                array2d[i] = new Array(height).fill(0);
            }

            // Loop through all the x and y positions in the 2D array
            for (var x = 0; x < width; x++) {
                for (var y = 0; y < height; y++) {

                    // Calculate the dot product of the vectors from the start point to the current position and from the start point to the end point
                    var dotProduct = (x - x1) * (x2 - x1) + (y - y1) * (y2 - y1);

                    // Calculate the length of the line segment
                    var segmentLength = Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2);

                    // Calculate the distance between the current position and the line segment
                    var distanceToLine = Math.abs((x - x1) * (y2 - y1) - (y - y1) * (x2 - x1)) / segmentLength;

                    // If the distance is less than or equal to half the thickness of the line, set the corresponding element in the 2D array to 1
                    var thickness = 20; // Adjust this value as radius of the line segment
                    if (distanceToLine <= thickness / 2 && dotProduct >= 0 && dotProduct <= segmentLength ** 2) {
                        array2d[x][y] = 1;
                    }
                }
            }
            // Define a Particle class
            class Particle {
                constructor(x, y, radius, color) {
                    this.x = x;
                    this.y = y;
                    this.radius = radius;
                    this.color = color;
                    this.velocity = {
                        x: Math.random() * 2 - 1,
                        y: Math.random() * 2 - 1
                        // x: -1.05,
                        // y: -1.05
                    }

                }

                draw() {
                    cvs.beginPath();
                    cvs.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    cvs.fillStyle = this.color;
                    cvs.fill();
                }

                update() {
                    this.draw();

                    // // Update position
                    // this.x += this.velocity.x;
                    // this.y += this.velocity.y;
                }
            }

            // Create a function to generate particles
            function generateParticles() {
                // for (var i = 0; i < 10; i++) {
                var x = 500;
                var y = 400;
                var radius = 4;
                var color = 'rgb(' + Math.random() * 255 + ', ' + Math.random() * 255 + ', ' + Math.random() * 255 + ')';
                particles.push(new Particle(x, y, radius, color));
                // }
            }
            const resetBtn = document.getElementById("reset-btn");
            resetBtn.addEventListener("click", () => {
                // Reset the position of the particle system
                // generateParticles();
                animate();
            });

            // Animation loop
            function animate() {
                requestAnimationFrame(animate);

                // Clear canvas
                cvs.clearRect(0, 0, canvas.width, canvas.height);
                // Draw the thick line segment
                var line = cvs.createLinearGradient(x1, y1, x2, y2);
                line.addColorStop(0, '#000000');
                line.addColorStop(1, '#FFFFFF');
                cvs.beginPath();
                cvs.moveTo(x1, y1);
                cvs.lineTo(x2, y2);
                cvs.lineWidth = radius;
                cvs.strokeStyle = line;
                cvs.lineCap = 'round';
                cvs.stroke();

                // draw to see if it successfully map on all 1s
                // // Loop through the 2D array and draw a rectangle for each cell that is equal to 1
                // for (var x = 0; x < array2d.length; x++) {
                //     for (var y = 0; y < array2d[x].length; y++) {
                //         if (array2d[x][y] == 1) {
                //             // Calculate the coordinates of the rectangle
                //             var rectX = x;
                //             var rectY = y;

                //             // Draw the rectangle
                //             cvs.fillRect(rectX, rectY, 1, 1);
                //         }
                //     }
                // }


                // Update particles
                for (var i = 0; i < particles.length; i++) {
                    var p = particles[i];
                    p.x += p.velocity.x;
                    p.y += p.velocity.y;

                    var xIndex = Math.floor(p.x);
                    var yIndex = Math.floor(p.y);
                    // Check if the particle is inside the line segment area
                    if (array2d[xIndex][yIndex] == 1) {
                        // p.inside();

                    }
                    // else if (array2d[100][100]) {
                    //     p.velocity.x = p.velocity.x;
                    //     p.velocity.y = p.velocity.y;
                    // }
                    else {
                        // p.velocity.x += -0.01;
                        // p.velocity.y += -0.01;
                        p.velocity.x = - p.velocity.x;
                        p.velocity.y = - p.velocity.y;
                    }


                    p.update();

                }
            }

            // Call the generateParticles function to create particles
            generateParticles();

            // Call the animate function to start the animation loop
            animate();
        }
    </script>
</head>

<body>
    <button id="reset-btn">Reset</button>
</body>

</html>